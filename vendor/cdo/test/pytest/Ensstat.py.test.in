#! @PYTHON@

from cdoTest import *
import os

OPERATORS=["ensmin", "ensmax", "ensrange", "enssum", "ensavg", "ensmean", "ensstd", "ensstd1", "ensvar", "ensvar1", "ensskew", "enskurt", "ensmedian"]

os.environ['CDO_FILE_SUFFIX'] = "NULL"
MISS_VALS={"no" : ("ts_mm_5years", "{}"), "yes" : ("ts_mm_5years_m","{}m")}

test_module = TestModule()
for KEY in MISS_VALS.keys():
    WITHMISSVALS="+missvals" if (KEY == "yes") else ""
    IFILES=f'{os.getpid()}ts_year'
    FILE=f'{DATAPATH}/{MISS_VALS[KEY][0]}'
    test_module.prepare(f'{CDO} splityear {FILE} {os.getpid()}ts_year')
    for OPERATOR in OPERATORS:
        RFORMAT=MISS_VALS[KEY][1].format(OPERATOR)
        RFILE=f'{DATAPATH}/{RFORMAT}_ref'
        OFILE=f'{RFORMAT}_ref'
        t = TAPTest(f'{OPERATOR}   {WITHMISSVALS}')
        t.add(f'{CDO} {OPERATOR} {IFILES}???? {OFILE}')
        t.diff(OFILE,RFILE)
        t.clean(OFILE)
        test_module.add(t)

test_module.clean(IFILES+"*")
test_module.run()
